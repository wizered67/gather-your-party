(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{34:function(e,t,n){e.exports=n(52)},39:function(e,t,n){},45:function(e,t,n){},52:function(e,t,n){"use strict";n.r(t);var a=n(0),o=n.n(a),r=n(30),i=n(27);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));n(39);var l=n(2),s=n(3),c=n(5),u=n(4),m=n(6),d=n(28),p=n(19),h=n(11),g=(n(45),n(16)),f=n(14),v=n(49),b=function(e){function t(){return Object(l.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){return o.a.createElement("div",null,o.a.createElement(y,null),this.props.children,o.a.createElement(O,null))}}]),t}(a.Component),E=function(e){function t(e){var n;return Object(l.a)(this,t),(n=Object(c.a)(this,Object(u.a)(t).call(this,e))).updateLoggedIn=function(){n.setState({loggedIn:x.auth.isLoggedIn}),x.auth.isLoggedIn?n.setState({loggedInEmail:x.auth.user.profile.data.email}):n.setState({loggedInEmail:""})},n.getLoginOrLogout=function(){return n.state.loggedIn?o.a.createElement("div",null,o.a.createElement("b",null,"Hello ",n.state.loggedInEmail,"!"),o.a.createElement("button",{onClick:n.logout},"Logout")):o.a.createElement("div",null,o.a.createElement("p",{style:{color:"red"}},n.state.loginErrorMessage),o.a.createElement("form",{onSubmit:n.handleSubmit},o.a.createElement("label",null,"E-mail:",o.a.createElement("input",{type:"text",name:"email",value:n.state.email,onChange:n.handleChange}),"Password:",o.a.createElement("input",{type:"password",name:"password",value:n.state.password,onChange:n.handleChange})),o.a.createElement("input",{type:"submit",value:"Submit"})),o.a.createElement(g.a,{to:"./register"},"Register"))},n.logout=function(){x.auth.logout().then(function(){n.updateLoggedIn(),n.props.history.push("/")})},n.handleChange=function(e){var t=e.target,a=t.value,o=t.name;n.setState(Object(f.a)({},o,a))},n.handleSubmit=function(e){e.preventDefault();var t=n.state,a=t.email,o=t.password,r=new h.d(a,o);x.auth.loginWithCredential(r).then(function(e){console.log("successfully logged in with id: ".concat(e))}).then(function(){return n.loginSuccess()}).catch(function(e){return n.loginError(e)})},n.loginSuccess=function(){n.updateLoggedIn(),n.setState({email:"",password:"",loginErrorMessage:""})},n.loginError=function(e){console.error("login error: ".concat(e));var t="login error: ".concat(e);n.setState({email:"",password:"",loginErrorMessage:t})},n.state={email:"",password:"",loggedIn:!1,loggedInEmail:"",loginErrorMessage:""},n}return Object(m.a)(t,e),Object(s.a)(t,[{key:"componentDidMount",value:function(){this.updateLoggedIn()}},{key:"render",value:function(){var e=this.getLoginOrLogout();return o.a.createElement("div",null,o.a.createElement("h1",null,"Gather Your Party!"),e,o.a.createElement(g.a,{to:"./"},"Home"))}}]),t}(a.Component),y=Object(v.a)(E),O=function(e){function t(){return Object(l.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){return o.a.createElement("p",null,"Copyright 2018")}}]),t}(a.Component),w=function(e){function t(){return Object(l.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){return o.a.createElement("div",{className:"App"},o.a.createElement(b,null,o.a.createElement(g.a,{to:"./new-post"},o.a.createElement("button",{variant:"raised"},"Find Adventurers!")),o.a.createElement(g.a,{to:"./posts"},o.a.createElement("button",{variant:"raised"},"Find Campaigns!")),o.a.createElement(g.a,{to:"./notifications"},o.a.createElement("button",{variant:"raised"},"Notifications"))))}}]),t}(a.Component),j=function(e){function t(e){var n;return Object(l.a)(this,t),(n=Object(c.a)(this,Object(u.a)(t).call(this,e))).getList=function(){n.setState({list:["hello","world","okay"]})},n.state={list:[]},n}return Object(m.a)(t,e),Object(s.a)(t,[{key:"componentDidMount",value:function(){this.getList()}},{key:"render",value:function(){var e=this.state.list;return o.a.createElement("div",{className:"App"},o.a.createElement(b,null,o.a.createElement("h1",null,"List of Items"),e.length?o.a.createElement("div",null,e.map(function(e){return o.a.createElement("div",null,e)})):o.a.createElement("div",null,o.a.createElement("h2",null,"No List Items Found"))))}}]),t}(a.Component),C=function(e){function t(e){var n;return Object(l.a)(this,t),(n=Object(c.a)(this,Object(u.a)(t).call(this,e))).handleChange=function(e){var t=e.target,a=t.value,o=t.name;n.setState(Object(f.a)({},o,a))},n.handleSubmit=function(e){e.preventDefault();var t=n.state,a=t.email,o=t.password;o===t.confirmPassword?h.b.defaultAppClient.auth.getProviderClient(h.c.factory).registerWithEmail(a,o).then(function(){console.log("Successfully sent account confirmation email!"),n.props.history.push("/")}).catch(function(e){console.log("Error registering new user:",e),n.registerError(e)}):n.setState({registerErrorMessage:"Passwords did not match."})},n.loginSuccess=function(){n.updateLoggedIn(),n.setState({email:"",password:"",loginErrorMessage:""})},n.registerError=function(e){if("name already in use"===e.message){h.b.defaultAppClient.auth.getProviderClient(h.c.factory).resendConfirmationEmail(n.state.email)}else{var t="login error: ".concat(e);n.setState({loginErrorMessage:t})}n.setState({email:"",password:"",confirmPassword:""})},n.state={email:"",password:"",confirmPassword:"",loggedIn:!1,registerErrorMessage:""},n}return Object(m.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){return o.a.createElement("div",{className:"App"},o.a.createElement(b,null,o.a.createElement("p",{style:{color:"red"}},this.state.registerErrorMessage),o.a.createElement("form",{onSubmit:this.handleSubmit},o.a.createElement("label",null,"E-mail:",o.a.createElement("input",{type:"text",name:"email",value:this.state.email,onChange:this.handleChange}),"Password:",o.a.createElement("input",{type:"password",name:"password",value:this.state.password,onChange:this.handleChange}),"Confirm Password:",o.a.createElement("input",{type:"password",name:"confirmPassword",value:this.state.confirmPassword,onChange:this.handleChange})),o.a.createElement("input",{type:"submit",value:"Submit"}))))}}]),t}(a.Component),_=function(e){function t(e){var n;return Object(l.a)(this,t),(n=Object(c.a)(this,Object(u.a)(t).call(this,e))).handleChange=function(e){var t=e.target,a=t.value,o=t.name;n.setState(Object(f.a)({},o,a))},n.handleSubmit=function(e){e.preventDefault();var t=n.state,a=t.title,o=t.content,r=x.auth.user,i=F.db("gather-your-party").collection("dm-posts"),l=n.state,s=l.latitude,c=l.longitude,u={type:"Point",coordinates:[parseFloat(c),parseFloat(s)]};i.insertOne({owner_id:r.id,owner_name:r.profile.data.email,title:a,content:o,interested:[],location:u}).then(function(){return n.props.history.push("/posts")})},n.state={title:"",content:"Describe your campaign here!",latitude:0,longitude:0},n}return Object(m.a)(t,e),Object(s.a)(t,[{key:"componentDidMount",value:function(){var e=this;navigator.geolocation.getCurrentPosition(function(t){e.setState({latitude:t.coords.latitude,longitude:t.coords.longitude})})}},{key:"render",value:function(){return o.a.createElement("div",{className:"App"},o.a.createElement(b,null,o.a.createElement("form",{onSubmit:this.handleSubmit},"Title: ",o.a.createElement("input",{type:"text",name:"title",value:this.state.title,onChange:this.handleChange}),o.a.createElement("br",null),o.a.createElement("textarea",{name:"content",rows:"15",cols:"50",value:this.state.content,onChange:this.handleChange}),o.a.createElement("br",null),"Latitude: ",o.a.createElement("input",{type:"text",name:"latitude",value:this.state.latitude,onChange:this.handleChange}),"Longitude: ",o.a.createElement("input",{type:"text",name:"longitude",value:this.state.longitude,onChange:this.handleChange}),o.a.createElement("br",null),o.a.createElement("input",{type:"submit",value:"Submit"}))))}}]),t}(a.Component);function S(e){return e*(Math.PI/180)}var k=function(e){function t(e){var n;return Object(l.a)(this,t),(n=Object(c.a)(this,Object(u.a)(t).call(this,e))).handleChange=function(e){var t=e.target,a=t.value,o=t.name;n.setState(Object(f.a)({},o,a))},n.tryComment=function(){n.setState({showCommentBox:!0})},n.leaveComment=function(e){e.preventDefault();var t=x.auth.user,a={post_id:n.props._id,owner_id:t.id,commenter:t.profile.data.email,content:n.state.commentContent,date:new Date,approved:!1};console.log(a),console.log(n.props._id);var o=F.db("gather-your-party").collection("comments");console.log(o.insertOne(a));var r=F.db("gather-your-party").collection("notifications"),i="".concat(t.profile.data.email,' applied for "').concat(n.state.title,'"!');r.insertOne({owner_id:n.state.owner_id,title:"New Application!",content:i,date:new Date}).then(function(){n.setState({showCommentBox:!1,commentContent:""}),n.props.commentRefresh()})},n.state={title:"",content:"",distance:0,owner_id:"",owner_name:"",postFound:!1,showCommentBox:!1,commentContent:""},n}return Object(m.a)(t,e),Object(s.a)(t,[{key:"refresh",value:function(){var e=this;console.log(this.props._id),F.db("gather-your-party").collection("dm-posts").find({_id:this.props._id}).asArray().then(function(t){if(console.log(t),t&&0!==t.length){t=t[0];var n=function(e,t,n,a){var o=S(n-e),r=S(a-t),i=Math.sin(o/2)*Math.sin(o/2)+Math.cos(S(e))*Math.cos(S(n))*Math.sin(r/2)*Math.sin(r/2);return 2*Math.atan2(Math.sqrt(i),Math.sqrt(1-i))*6371}(e.props.userLatitude,e.props.userLongitude,t.location.coordinates[1],t.location.coordinates[0]);e.setState({title:t.title,content:t.content,distance:n,postFound:!0,owner_id:t.owner_id,owner_name:t.owner_name})}else e.setState({postFound:!1})})}},{key:"componentDidMount",value:function(){this.refresh()}},{key:"render",value:function(){var e=this,t=o.a.createElement("div",null,o.a.createElement("h1",null,"Post not found!"));return this.state.postFound&&(t=o.a.createElement("div",{onClick:function(){return e.tryComment()}},o.a.createElement("hr",null),o.a.createElement("h1",null,this.state.title),o.a.createElement("b",null,this.state.owner_name),o.a.createElement("br",null),o.a.createElement("b",null,"Distance: ",this.state.distance.toFixed(2)," miles"),o.a.createElement("p",null,this.state.content),this.state.showCommentBox?o.a.createElement("form",{onSubmit:this.leaveComment},o.a.createElement("textarea",{name:"commentContent",rows:"5",cols:"50",value:this.state.commentContent,onChange:this.handleChange}),o.a.createElement("br",null),o.a.createElement("input",{type:"submit",value:"Apply"})):null)),t}}]),t}(a.Component),I=n(21),P=function(e){function t(e){var n;return Object(l.a)(this,t),(n=Object(c.a)(this,Object(u.a)(t).call(this,e))).refresh=function(){console.log("gg refresh called!"),console.log(n.props),console.log(n.props._id),F.db("gather-your-party").collection("comments").find({post_id:n.props._id}).asArray().then(function(e){console.log(e),n.setState({comments:e})})},n.render=function(){return o.a.createElement("div",null,n.state.comments.length?o.a.createElement("div",null,n.state.comments.map(function(e){var t=e._id,a=e.post_id,r=e.owner_id,i=e.commenter,l=e.date,s=e.content,c=e.approved;return o.a.createElement("div",{key:t}," ",o.a.createElement(M,{post_id:a,owner_id:r,postOwnerId:n.props.postOwnerId,commenter:i,content:s,date:l.toString(),approved:c,refresh:n.refresh,postTitle:n.props.postTitle}))})):o.a.createElement("div",null,o.a.createElement("h4",null,"No Comments Found")))},n.state={comments:[]},n.props.setCommentsPointer(Object(I.a)(Object(I.a)(n))),n}return Object(m.a)(t,e),Object(s.a)(t,[{key:"componentDidMount",value:function(){this.refresh()}}]),t}(a.Component),M=function(e){function t(e){var n;return Object(l.a)(this,t),(n=Object(c.a)(this,Object(u.a)(t).call(this,e))).acceptComment=function(){F.db("gather-your-party").collection("comments").updateMany({owner_id:n.props.owner_id,post_id:n.props.post_id},{$set:{approved:!0}}).then(function(){n.props.refresh();var e=F.db("gather-your-party").collection("notifications"),t="You've been accepted to join \"".concat(n.props.postTitle,'"! Let the adventures begin!');e.insertOne({owner_id:n.props.owner_id,originalContent:"post_".concat(n.props.post_id),title:"You've Been Accepted!",content:t,date:new Date}).then(function(){})})},n}return Object(m.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){var e=x.auth.user.id;console.log(e);var t=!this.props.approved||this.props.postOwnerId!==e&&this.props.owner_id!==e?"black":"green";return console.log(t),o.a.createElement("div",null,o.a.createElement("b",{style:{color:t}},this.props.commenter),o.a.createElement("br",null),o.a.createElement("b",null,this.props.date),o.a.createElement("p",null,this.props.content),this.props.postOwnerId!==e||this.props.postOwnerId===this.props.owner_id||this.props.approved?null:o.a.createElement("div",null,o.a.createElement("button",{onClick:this.acceptComment},"Accept")))}}]),t}(a.Component),D=function(e){function t(e){var n;return Object(l.a)(this,t),(n=Object(c.a)(this,Object(u.a)(t).call(this,e))).updateDistance=function(e){if(!n.state.locationSet){var t=F.db("gather-your-party").collection("dm-posts"),a={location:{$near:{$geometry:{type:"Point",coordinates:[e.coords.longitude,e.coords.latitude]}}}};t.find(a,{_id:1,limit:10}).asArray().then(function(t){n.setState({postIDs:t,locationSet:!0,latitude:e.coords.latitude,longitude:e.coords.longitude})})}},n.forceRefresh=function(){for(var e=n.state.commentsPointers.length-1;e>=0;e--){var t=n.state.commentsPointers[e];t&&t.refresh()}},n.setCommentsPointer=function(e){n.state.commentsPointers.push(e)},n.state={postIDs:[],locationSet:!1,latitude:0,longitude:0,commentsPointers:[]},n}return Object(m.a)(t,e),Object(s.a)(t,[{key:"componentDidMount",value:function(){navigator.geolocation.getCurrentPosition(this.updateDistance)}},{key:"render",value:function(){var e=this;return o.a.createElement("div",{className:"App"},o.a.createElement(b,null,this.state.postIDs.length?o.a.createElement("div",null,this.state.postIDs.map(function(t){return o.a.createElement("div",{key:t._id,id:"post_".concat(t._id)},o.a.createElement(k,{_id:t._id,userLatitude:e.state.latitude,userLongitude:e.state.longitude,commentRefresh:e.forceRefresh}),o.a.createElement("br",null),o.a.createElement(P,{_id:t._id,postTitle:t.title,postOwnerId:t.owner_id,setCommentsPointer:e.setCommentsPointer}))})):o.a.createElement("div",null,o.a.createElement("h2",null,"No Posts Found"))))}}]),t}(a.Component),L=(n(51),function(e){function t(){return Object(l.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){return o.a.createElement("div",null,o.a.createElement("hr",null),o.a.createElement("h2",null,this.props.title),o.a.createElement("b",null,this.props.date),o.a.createElement("p",null,this.props.content))}}]),t}(a.Component)),A=function(e){function t(e){var n;return Object(l.a)(this,t),(n=Object(c.a)(this,Object(u.a)(t).call(this,e))).updateDistance=function(e){if(!n.state.locationSet){var t=x.auth.user.id,a=F.db("gather-your-party").collection("notifications").find({owner_id:t},{sort:{date:-1}});console.log(a),a.asArray().then(function(e){console.log(e),n.setState({notifications:e})})}},n.state={notifications:[]},n}return Object(m.a)(t,e),Object(s.a)(t,[{key:"componentDidMount",value:function(){navigator.geolocation.getCurrentPosition(this.updateDistance)}},{key:"render",value:function(){return o.a.createElement("div",{className:"App"},o.a.createElement(b,null,this.state.notifications.length?o.a.createElement("div",null,this.state.notifications.map(function(e){var t=e.title,n=e.date,a=e.content,r=e.originalContent,i="/posts#".concat(r);return o.a.createElement("div",{key:e._id},o.a.createElement(L,{link:i,title:t,date:n.toString(),content:a}))})):o.a.createElement("div",null,o.a.createElement("h2",null,"You have no notifications"))))}}]),t}(a.Component),x=h.b.initializeDefaultAppClient("gather-your-party-qnzcm"),F=x.getServiceClient(h.a.factory,"mongodb-atlas"),N=function(e){function t(){return Object(l.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){return o.a.createElement(d.a,null,o.a.createElement(function(){return o.a.createElement("div",null,o.a.createElement(d.a,null,o.a.createElement(p.a,{exact:!0,path:"/",component:w}),o.a.createElement(p.a,{path:"/list",component:j}),o.a.createElement(p.a,{path:"/register",component:C}),o.a.createElement(p.a,{path:"/new-post",component:_}),o.a.createElement(p.a,{path:"/posts",component:D}),o.a.createElement(p.a,{path:"/notifications",component:A})))},null))}}]),t}(a.Component);Object(r.render)(o.a.createElement(i.a,{basename:"/gather-your-party"},o.a.createElement(N,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[34,2,1]]]);
//# sourceMappingURL=main.d916d737.chunk.js.map